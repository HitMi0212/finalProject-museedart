<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="addition">
	<select id="noticeList" parameterType="map" resultType="board">
		select
			rnum as bnum, 
			board_no as boardNo,
			board_title as boardTitle,
			board_writer as boardWriter,
			readcount as readCount,
			reg_date as regDate
		from 
		(select rownum as rnum,n.* from 
		(select*
		from board where boardtype=#{boardType} order by board_no desc)n) 
		where rnum between #{start} and #{end} 
	</select>
	<select id="totalCount" parameterType="map" resultType="_int">
		select count(*) from board where boardtype=#{boardType}
	</select>
	<insert id="insertBoard" parameterType="board">
		insert into board values (board_seq.nextval,#{boardWriter},#{boardTitle},#{boardContent},default,to_char(sysdate,'yyyy-mm-dd'),#{boardType})
		<selectKey  resultType="_int" order="AFTER" keyProperty="boardNo">
			select max(board_no) from board
		</selectKey>
	</insert>
	<select id="getBoardNo" resultType="_int">
		select max(board_no) from board
	</select>
	<insert id="insertFile" parameterType="kr.or.addition.model.vo.FileVO">
		insert into file_tbl values(file_seq.nextval,#{boardNo},#{filename},#{filepath})
	</insert>
	<select id="selectOneBoard" parameterType="_int" resultMap="board">
		select*from board where board_no=#{boardNo}
	</select>
	<select id="selectFilelist" parameterType="_int" resultType="kr.or.addition.model.vo.FileVO">
		select	
			file_no as fileNo,
			board_no as boardNo,
			filename,
			filepath
		from file_tbl where board_no = #{boardNo}	
	</select>
	<resultMap type="board" id="board">
		<result column="board_no" property="boardNo"/>
		<result column="board_title" property="boardTitle"/>
		<result column="board_content" property="boardContent"/>
		<result column="board_writer" property="boardWriter"/>
		<result column="readcount" property="readCount"/>
		<result column="reg_date" property="regDate"/>
		<collection property="list" column="board_no" javaType="java.util.ArrayList" ofType="kr.or.addition.model.vo.FileVO" select="selectFilelist"></collection>
	</resultMap>
	<delete id="boardDelete" parameterType="_int">
		delete from board where board_no=#{boardNo}
	</delete>
	<update id="updateReadCount" parameterType="_int">
		update board set readcount=readcount+1 where board_no=#{boardNo}
	</update>
	<select id="selectCommentList" parameterType="_int" resultType="kr.or.addition.model.vo.BoardComment">
		select	
			bc_no as bcNo,
			bc_level as bcLevel,
			bc_writer as bcWriter,
			bc_content as bcContent,
			reg_date as regDate,
			board_ref as boardRef,
			bc_ref as bcRef,
			bcid_ref as bcidRef
		from comment1 where board_ref = #{boardNo}
	</select>
</mapper>
