<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="show">
	<select id="showList" resultType="show">
		select
			show_no as showNo,
			show_name as showName,
			show_start as showStart,
			show_end as showEnd,
			filepath
		from show order by 1 desc
	</select>
	<select id="selectOneShow" parameterType="_int" resultMap="s">
		select * from show where show_no=#{showNo}
	</select>
	<select id="starAvg" parameterType="_int" resultType="_double">
		select nvl(avg(star),0) from show_review where show_no = #{showNo}
	</select>
	<insert id="insertShow" parameterType="show">
		insert into show values(show_seq.nextval, #{showName}, #{showStart}, #{showEnd}, #{showTime}, #{showAge}, #{showContent}, #{showPrice}, 0, #{filepath}, #{showHall})
	</insert>
	<delete id="deleteShow" parameterType="_int">
		delete from show where show_no=#{showNo}
	</delete>
	<update id="updateShow" parameterType="show">
		update show set show_name=#{showName}, show_start=#{showStart}, show_end=#{showEnd}, show_time=#{showTime}, show_age=#{showAge}, show_content=#{showContent}, show_price=#{showPrice}, filepath=#{filepath}, show_hall=#{showHall} where show_no=#{showNo}
	</update>
	<select id="selectReviewList" parameterType="_int" resultType="sReview">
		select
			review_no as reviewNo,
			show_no as showNo,
			review_writer as reviewWriter,
			review_content as reviewContent,
			star,
			review_date as reviewDate
		from show_review where show_no=#{showNo} order by 1 desc
	</select>
	<delete id="deleteReview" parameterType="sReview">
		delete from show_review where review_no=#{reviewNo} and show_no=#{showNo}
	</delete>
	<insert id="insertReview" parameterType="sReview">
		insert into show_review values(sreview_seq.nextval, #{showNo}, #{reviewWriter}, #{reviewContent}, #{star}, to_char(sysdate, 'yyyy-mm-dd'))
	</insert>
	<update id="updateReview" parameterType="sReview">
		update show_review set review_content=#{reviewContent} where review_no=#{reviewNo} and show_no=#{showNo}
	</update>
	
	<resultMap type="show" id="s">
		<result column="show_no" property="showNo"/>
		<result column="show_name" property="showName"/>
		<result column="show_start" property="showStart"/>
		<result column="show_end" property="showEnd"/>
		<result column="show_time" property="showTime"/>
		<result column="show_age" property="showAge"/>
		<result column="show_content" property="showContent"/>
		<result column="show_price" property="showPrice"/>
		<result column="show_seat" property="showSeat"/>
		<result column="filepath" property="filepath"/>
		<result column="show_hall" property="showHall"/>
	</resultMap>
</mapper>
